apiVersion: v1
kind: ConfigMap
metadata:
  name: prometheus-alert-rules
  namespace: monitoring-project
  labels:
    app: prometheus
data:
  high-latency.rules.yml: |
    groups:
      - name: api-latency-alerts
        rules:
          - alert: HighLatencyP95
            expr: histogram_quantile(0.95, sum by(le) (rate(api_latency_seconds_bucket{job="api-latency-monitor"}[5m])))
            for: 2m
            labels:
              severity: critical
              team: sre
            annotations:
              summary: "High 95th percentile latency for {{ $labels.app }}"
              description: "{{ $labels.app }} has 95th percentile latency of {{ $value | humanizeDuration }}."

          - alert: HighErrorRate
            expr: 100 * rate(api_latency_seconds_count{job="api-latency-monitor",status=~"5.."}[5m]) / rate(api_latency_seconds_count{job="api-latency-monitor"}[5m]) > 5
            for: 1m
            labels:
              severity: warning
              team: sre
            annotations:
              summary: "High error rate for {{ $labels.app }}"
              description: "{{ $labels.app }} has error rate of {{ $value | printf \"%.2f\" }}% (5xx responses)."